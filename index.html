<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>KANKAKUクエスト — あなたの感覚ジョブ診断</title>
    <!-- Chart.js（レーダーチャート用） -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
      :root{
        --bg:#f7f8fb; --card:#fff; --ink:#0f172a; --muted:#616b7c; --brand:#2563eb; --brand2:#0f172a;
        --ring:#e5e7eb; --good:#16a34a; --warn:#ea580c;
      }
      *{box-sizing:border-box}
      body{margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; color:var(--ink); background:linear-gradient(#f7f8fb,#fff)}
      .container{max-width:960px; margin:0 auto; padding:16px}
      header{position:sticky; top:0; background:#ffffffbb; backdrop-filter:saturate(1.1) blur(6px); border-bottom:1px solid var(--ring)}
      header .bar{display:flex; align-items:center; justify-content:space-between; padding:10px 16px}
      .brand{display:flex; gap:10px; align-items:center; cursor:pointer; text-decoration:none; color:inherit}
      .brand .logo{width:32px;height:32px;border-radius:10px;background:var(--brand2);color:#fff;display:grid;place-items:center;font-weight:700}
      .button{border:1px solid var(--ring); background:#fff; padding:10px 14px; border-radius:12px; cursor:pointer}
      .button.primary{background:var(--brand); color:#fff; border-color:transparent}
      .button[disabled]{opacity:.5; cursor:not-allowed}
      /* ブランドカラーのシェアボタン */
      .button.x  { background:#000;   color:#fff; border-color:#000 }
      .button.fb { background:#1877F2; color:#fff; border-color:#1877F2 }
      .button.x:hover,.button.fb:hover{filter:brightness(.95)}
      .grid{display:grid; gap:16px}
      .card{background:var(--card); border:1px solid var(--ring); border-radius:16px; padding:18px}
      .hero img{width:70%; max-width:800px; margin:0 auto; display:block} /* タイトル画像70% */
      .progress{height:8px; background:#e5e7eb; border-radius:99px; overflow:hidden}
      .progress > div{height:100%; background:var(--brand2)}
      .likert{display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-top:16px}
      .likert button{padding:10px 14px; border:1px solid var(--ring); border-radius:12px; background:#fff8db} /* 薄い黄色 */
      .likert button:hover{background:#ffefaf}
      .likert button.active{background:#fde68a; border-color:#facc15}
      .cols{display:grid; gap:16px}
      @media(min-width:900px){.cols{grid-template-columns:repeat(3,1fr)}}
      .small{font-size:12px; color:#475569}
      .muted{color:#616b7c}
      .badge{display:inline-block; font-size:12px; padding:3px 8px; border-radius:999px; background:#eef2ff}
      .center{text-align:center}
      /* 画像を1.5倍（160→240） */
      img.role{width:240px; height:auto; display:block; margin:8px auto 0}
      /* レベル表記を大きく */
      .level-display{font-size:20px; font-weight:700; margin-top:6px}
      footer{color:#6b7280; font-size:12px; padding:24px 16px}
      .cta{background:#eff6ff; border:1px solid #bfdbfe}
      .start-actions{display:flex; gap:10px; flex-wrap:wrap; justify-content:center; align-items:center; margin-top:12px}
      .share{display:grid; gap:10px; justify-items:center}
      .share .buttons{display:flex; flex-wrap:wrap; gap:8px; justify-content:center}
      .level-grid{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px}
      @media(min-width:700px){.level-grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
      .level-item{border:1px solid var(--ring); border-radius:12px; padding:10px; background:#fff}
      .level-item .lv{font-weight:700}
      .chip{display:inline-block; padding:2px 8px; font-size:12px; border-radius:999px; background:#f1f5f9; margin-left:6px}
    </style>
  </head>
  <body>
    <header>
      <div class="bar container">
        <a id="homeLink" class="brand">
          <div class="logo">Q</div><div style="font-weight:700">KANKAKUクエスト</div>
        </a>
        <a id="seminarBtnTop" class="button primary" target="_blank" href="#">8/23 セミナーを見る</a>
      </div>
    </header>

    <main id="app" class="container"></main>

    <footer class="container">
      <div style="margin-bottom:6px;">by <strong>MANAKURO</strong></div>
      プライバシー：回答は端末内で処理され、同意なく保存されません。
    </footer>

    <script>
      /* ================= 設定 ================= */
      const SEMINAR_DATE = '2025-08-23';
      const SEMINAR_URL  = 'https://forms.gle/hWcV6LZDvR2S9wX88';
      const QUESTION_COUNT = 28; // しっかり相当：固定

      const IMAGES = {
        title: 'images/title-image.png',
        rolesHyper: {
          hearing:   'images/job-elf-scout.png',
          vision:    'images/job-wizard.png',
          touch:     'images/job-guardian.png',
          smell:     'images/job-poison-appraiser.png',
          taste:     'images/job-gourmet.png',
          tempPain:  'images/job-weather-mage.png',
          movement:  'images/job-knight.png'
        },
        rolesHypo: {
          hearing:   'images/job-hearing-hypo.png',
          vision:    'images/job-vision-hypo.png',
          touch:     'images/job-touch-hypo.png',
          smell:     'images/job-smell-hypo.png',
          taste:     'images/job-taste-hypo.png',
          tempPain:  'images/job-tempPain-hypo.png',
          movement:  'images/job-movement-hypo.png'
        },
        balanced: 'images/job-nomal.png' // バランス型：ノーマライザー
      };

      const TITLES = {
        hyper: {
          hearing:  { t: 'エルフ耳の斥候（スカウト）', role: 'スカウト' },
          vision:   { t: '洞察の魔法使い（メイジ）', role: 'メイジ' },
          touch:    { t: '結界の守護者（ガーディアン）', role: 'ガーディアン' },
          smell:    { t: '毒の鑑定士（アルケミスト）', role: 'アルケミスト' },
          taste:    { t: '美食の王子／姫（グルメ）', role: 'グルメ' },
          tempPain: { t: '気候予報士（メイジ）', role: 'メイジ' },
          movement: { t: '揺れセンサー搭載者（ナイト）', role: 'ナイト' },
        },
        hypo: {
          hearing:  { t: '戦場の鼓手（バード）', role: 'バード' },
          vision:   { t: '月影のハンター（ハンター）', role: 'ハンター' },
          touch:    { t: '鉄皮のモンク（モンク）', role: 'モンク' },
          smell:    { t: '炉心の鍛冶師（ブラックスミス）', role: 'ブラックスミス' },
          taste:    { t: '香辛の冒険家（エクスプローラー）', role: 'エクスプローラー' },
          tempPain: { t: '四季渡りのノマド（ノマド）', role: 'ノマド' },
          movement: { t: '竜騎のランサー（ドラグーン）', role: 'ドラグーン' },
        },
      };

      const AXES = [
        { key: 'hearing',  label: '聴覚' },
        { key: 'vision',   label: '視覚' },
        { key: 'touch',    label: '触覚' },
        { key: 'smell',    label: '嗅覚' },
        { key: 'taste',    label: '味覚' },
        { key: 'tempPain', label: '温度/痛み' },
        { key: 'movement', label: '動き' },
      ];

      /* ================ 質問 ================ */

const BANK = [
  // ── 聴覚 ──
  { id:'h_h_1', axis:'hearing', trait:'hyper', adult:'店内やオフィスのざわめきで集中が切れやすい' },         // 過敏：回避
  { id:'h_h_2', axis:'hearing', trait:'hyper', adult:'突然の大きな音が苦手で、体が強く反応してしまう' },       // 過敏：驚愕反応
  { id:'h_y_1', axis:'hearing', trait:'hypo',  adult:'にぎやかな場所でも会話を続けられることが多い' },         // 鈍麻：閾値高
  { id:'h_y_2', axis:'hearing', trait:'hypo',  adult:'雑音の中で呼ばれても気づかないことがある' },             // 鈍麻：気づき遅れ

  // ── 視覚 ──
  { id:'v_h_1', axis:'vision', trait:'hyper', adult:'強い照明や画面の光がつらく、遮光したくなる' },           // 過敏：光
  { id:'v_h_2', axis:'vision', trait:'hyper', adult:'画面のちらつきや速い動きに疲れやすい' },                 // 過敏：ちらつき/動き
  { id:'v_y_1', axis:'vision', trait:'hypo',  adult:'暗い場所でもあまり困らない' },                           // 鈍麻：暗所に強い
  { id:'v_y_2', axis:'vision', trait:'hypo',  adult:'画面や印刷の細かい違いに気づかないことがある' },           // 鈍麻：細部の検知弱

  // ── 触覚 ──
  { id:'t_h_1', axis:'touch', trait:'hyper', adult:'チクチクする服やタグが苦手' },                            // 過敏：素材
  { id:'t_h_2', axis:'touch', trait:'hyper', adult:'手や服のベタつきが気になりやすい' },                      // 過敏：汚れ/粘着
  { id:'t_y_1', axis:'touch', trait:'hypo',  adult:'ぎゅっとした圧があると落ち着くことがある' },              // 鈍麻：圧刺激好み
  { id:'t_y_2', axis:'touch', trait:'hypo',  adult:'軽い擦り傷にすぐ気づかないことがある' },                  // 鈍麻：気づき遅れ

  // ── 嗅覚 ──
  { id:'s_h_1', axis:'smell', trait:'hyper', adult:'香水や柔軟剤のにおいが強く感じられて離れたくなる' },      // 過敏：香料
  { id:'s_h_2', axis:'smell', trait:'hyper', adult:'料理のにおいが混ざる場所が苦手' },                        // 過敏：混合臭
  { id:'s_y_1', axis:'smell', trait:'hypo',  adult:'強いにおいでも平気なことが多い' },                        // 鈍麻：閾値高
  { id:'s_y_2', axis:'smell', trait:'hypo',  adult:'食品の傷みのにおいに気づくのが遅れることがある' },        // 鈍麻：気づき遅れ

  // ── 味覚 ──
  { id:'ta_h_1', axis:'taste', trait:'hyper', adult:'繊細な味の違いがわかり、好みがはっきりしている' },        // 過敏：微差検知
  { id:'ta_h_2', axis:'taste', trait:'hyper', adult:'食感や香りが合わないと食べづらいことがある' },            // 過敏：回避
  { id:'ta_y_1', axis:'taste', trait:'hypo',  adult:'濃い味やスパイスの強い料理が好き' },                      // 鈍麻：強刺激好み
  { id:'ta_y_2', axis:'taste', trait:'hypo',  adult:'新しい味の刺激を試したくなることが多い' },                // 鈍麻：刺激希求

  // ── 温度/痛み ──
  { id:'tp_h_1', axis:'tempPain', trait:'hyper', adult:'室温のわずかな変化が気になる' },                      // 過敏：温度
  { id:'tp_h_2', axis:'tempPain', trait:'hyper', adult:'小さな痛みでも集中が切れやすい' },                    // 過敏：痛み
  { id:'tp_y_1', axis:'tempPain', trait:'hypo',  adult:'暑さ寒さに気づくのが遅れることがある' },              // 鈍麻：気づき遅れ
  { id:'tp_y_2', axis:'tempPain', trait:'hypo',  adult:'軽いケガでも痛みをあまり感じないことがある' },          // 鈍麻：閾値高

  // ── 動き ──
  { id:'m_h_1', axis:'movement', trait:'hyper', adult:'人混みや揺れで酔いやすい' },                           // 過敏：平衡感
  { id:'m_h_2', axis:'movement', trait:'hyper', adult:'急な動きや加速が苦手' },                               // 過敏：加速度
  { id:'m_y_1', axis:'movement', trait:'hypo',  adult:'スピードや回転を楽しめる' },                            // 鈍麻：強刺激好み
  { id:'m_y_2', axis:'movement', trait:'hypo',  adult:'刺激を求めて、つい走ったりジャンプしたくなる' },        // 鈍麻：刺激希求
      ];

      const COMMENT_BOOK = {
        hearing: {
          hyper: { strong:['微かな音の変化に気づける観察力'], challenge:['人混みや大音量の場所で疲れやすい'], tips:['ノイズキャンセリング/耳栓の活用','静かな席や時間帯を選ぶ','通知音量の微調整'] },
          hypo:  { strong:['賑やかな環境でも集中しやすい'], challenge:['呼びかけやアナウンスを聞き逃しやすい'], tips:['バイブ/光での通知','視覚サインの併用','重要連絡は文字ベースで受け取る'] }
        },
        vision: {
          hyper: { strong:['細かな差異にすぐ気づける洞察力'], challenge:['強い光/ちらつきで疲れやすい'], tips:['遮光/偏光レンズ','画面の明るさ/配色を調整','紙面作業をこまめに挟む'] },
          hypo:  { strong:['暗所で落ち着いて動ける'], challenge:['細部の変化に気づきにくい'], tips:['コントラスト強調','要点のマーキング','タスク前のチェックリスト'] }
        },
        touch: {
          hyper: { strong:['素材/肌触りへの審美眼'], challenge:['タグ/チクチク/ベタつきがストレス'], tips:['肌当たりの良い素材選び','タグカット/裏返し着用','ウェットティッシュ常備'] },
          hypo:  { strong:['圧や重みで落ち着きやすい'], challenge:['小さなケガや汚れに気づきにくい'], tips:['定期的なボディチェック','加重ブランケットの活用','触覚入力のバランス'] }
        },
        smell: {
          hyper: { strong:['香りの違いを見分ける能力'], challenge:['香料が混ざる場所が苦手'], tips:['マスク/アロマでリセット','換気の良い席を確保','香り強い洗剤を避ける'] },
          hypo:  { strong:['強い匂いにも冷静'], challenge:['危険な臭いに気づきにくい'], tips:['期限表示の確認習慣','他者に確認を頼む','におい以外の衛生指標を使う'] }
        },
        taste: {
          hyper: { strong:['味の違いを楽しむ繊細さ'], challenge:['食べられる品目が限られやすい'], tips:['食感/香り単位での置き換え','調味/調理法の微調整','小さな一歩の試食'] },
          hypo:  { strong:['刺激的な味を楽しむ冒険心'], challenge:['塩分/辛味の過剰に注意'], tips:['栄養バランス表の活用','味以外（温度/見た目）の満足要素を増やす','医療的制限がある場合は専門家相談'] }
        },
        tempPain: {
          hyper: { strong:['体調変化の早期察知'], challenge:['気温/痛みの変化で消耗しやすい'], tips:['重ね着/冷温アイテム','作業時間を短ブロック化','こまめな休憩'] },
          hypo:  { strong:['幅広い環境に適応できる'], challenge:['熱中症/低体温に気づきにくい'], tips:['タイマーで水分/休憩を促す','活動ログで体調を可視化','危険温度の客観指標を使う'] }
        },
        movement: {
          hyper: { strong:['バランス変化に敏感'], challenge:['乗り物酔い/人混みがつらい'], tips:['混雑回避ルート','安定した姿勢/視点固定','乗り物は前方/風通し良い席'] },
          hypo:  { strong:['スリル/運動を楽しめる'], challenge:['危険察知が遅れがち'], tips:['安全ルールの事前確認','プロテクターの使用','段階的に刺激レベルを上げる'] }
        },
      };

      /* === 140字向けショート要約 === */
      const SHORT_SUMMARY = {
        hearing:  { hyper:'小さな音を拾いやすい／大きな音がつらい', hypo:'にぎやかでも集中しやすい／呼びかけを見落としがち' },
        vision:   { hyper:'細部に気づく／強い光やちらつきが苦手',       hypo:'暗所に強い／細かな変化は見落としやすい' },
        touch:    { hyper:'素材感に敏感／チクチクやベタつきが苦手',       hypo:'圧刺激で落ち着く／小さなケガに気づきにくい' },
        smell:    { hyper:'香りの差に鋭い／混ざったにおいが苦手',         hypo:'強いにおいも平気／危険なにおいに気づきにくい' },
        taste:    { hyper:'味の違いに敏感／食べられる幅が狭くなりがち',   hypo:'刺激的な味が得意／塩分や辛味が多くなりがち' },
        tempPain: { hyper:'変化を早く察知／気温や痛みで消耗しやすい',     hypo:'環境にタフ／暑さ寒さに気づくのが遅れがち' },
        movement: { hyper:'揺れに敏感／人混みや乗り物酔いが出やすい',     hypo:'スピードに強い／安全確認が遅れがち' },
        balanced: '偏りは少なめ。感じ方は状況次第。'
      };
      function getShortSummary(overall, dominant){
        if (overall==='balanced') return SHORT_SUMMARY.balanced;
        return SHORT_SUMMARY[dominant][overall];
      }
      function baseURL(){
        return location.origin + location.pathname.replace(/index\.html$/,'');
      }

      /* === 改行入り：140字に収める投稿文 === */
      function buildShortShareText({title, level, overall, dominant}){
        const url = baseURL();
        const urlLen = 23; // XのURL換算長
        const axis = AXES.find(a=>a.key===dominant)?.label || 'バランス型';
        const line1 = '【感覚クエスト⚔️診断結果】';
        const line2 = `称号「${title}」 Lv${String(level).padStart(2,'0')}`;
        const line3 = (overall==='balanced')
          ? getShortSummary(overall, dominant)
          : `いちばん強いのは「${axis}」。${getShortSummary(overall, dominant)}`;
        const line4 = 'やってみる▶ ' + url;
        const tag  = ' #KANKAKUクエスト';
        const nl = '\n';
        let text = [line1, line2, line3, line4].join(nl) + tag;

        // 140字内に調整（URLは固定長23として計算）
        const limit = 140;
        const effLen = t => t.length - (url.length - urlLen);
        if (effLen(text) <= limit) return text;
        // 1) ハッシュタグを外す
        text = [line1, line2, line3, line4].join(nl);
        if (effLen(text) <= limit) return text;
        // 2) line3を短縮
        const short3 = (overall==='balanced')
          ? '偏りは少なめ。感じ方は状況次第。'
          : `最も強い「${axis}」。${getShortSummary(overall, dominant).split('／')[0]}`;
        text = [line1, line2, short3, line4].join(nl);
        if (effLen(text) <= limit) return text;
        // 3) さらに圧縮（axisのみ）
        const tiny3 = (overall==='balanced') ? '偏りは少なめ。' : `最も強い「${axis}」。`;
        text = [line1, line2, tiny3, line4].join(nl);
        return text;
      }

      /* === 非線形ウェイト（1・2は軽め） === */
      // 0→0.00 / 1→0.08 / 2→0.28 / 3→0.65 / 4→1.00
      const LIKERT_WEIGHT = [0, 0.08, 0.28, 0.65, 1.00];

      const LIKERT = [
        { v:0, label:'まったくない' },
        { v:1, label:'すこし' },
        { v:2, label:'ときどき' },
        { v:3, label:'よくある' },
        { v:4, label:'とても強い' },
      ];

      /* ================ 状態 ================ */
      let qs = []; let answers = {}; let index = 0;
      const app = document.getElementById('app');

      /* ================ 画面 ================ */
      function renderStart(){
        app.innerHTML = `
          <div class="grid">
            <div class="card hero"><img src="${IMAGES.title}" alt="KANKAKUクエスト タイトル"></div>
            <div class="card" style="text-align:center">
              <h1>あなたの感覚ジョブ診断</h1>
              <p class="muted">
                簡単な質問に答えるだけで、聴覚・視覚・触覚・嗅覚・味覚・温度/痛み・<strong>動き</strong>の感じ方を見える化。<br>
                最後にレーダーチャートとRPG風の称号が表示されます。
              </p>
              <div class="start-actions">
                <button class="button primary" id="startBtn">診断をスタート</button>
              </div>
            </div>
          </div>`;
        document.getElementById('startBtn').onclick=()=>{ startQuestions(); };
        window.scrollTo({top:0, behavior:'smooth'});
      }

      function startQuestions(){
        qs = pickQuestions(QUESTION_COUNT);
        answers = {}; index = 0;
        renderQuestion();
      }

      function renderQuestion(){
        const total = qs.length;
        const q = qs[index];
        const answered = answers[q.id];
        const progress = Math.round(Object.keys(answers).length/total*100);
        app.innerHTML = `
          <div class="grid">
            <div class="progress"><div style="width:${progress}%"></div></div>
            <div class="card" style="text-align:center">
              <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:8px">
                <div><span class="badge">${AXES.find(a=>a.key===q.axis).label}</span></div>
                <div class="small">${index+1} / ${total}</div>
              </div>
              <div style="font-size:18px; margin-bottom:20px">${q.adult}</div> <!-- 質問とボタンの間に余白 -->
              <div class="likert" id="likert"></div>
              <div style="display:flex; justify-content:space-between; margin-top:14px">
                <button class="button" id="prevBtn" ${index===0?'disabled':''}>もどる</button>
                <span></span>
              </div>
            </div>
          </div>`;
        const wrap = document.getElementById('likert');
        LIKERT.forEach(o=>{
          const btn = document.createElement('button');
          btn.textContent = o.label;
          btn.className='button';
          if(answered===o.v) btn.classList.add('active');
          btn.onclick=()=> selectAndNext(o.v);
          wrap.appendChild(btn);
        });
        document.getElementById('prevBtn').onclick=()=>{ if(index>0){ index--; renderQuestion(); } };
        window.scrollTo({top:0, behavior:'smooth'});
      }

      // 選択→即次へ
      function selectAndNext(value){
        const q = qs[index];
        answers[q.id] = value;
        const total = qs.length;
        if(index+1 < total){ index++; renderQuestion(); }
        else { renderResult(); }
      }

      /* ================ 結果 ================ */
      function renderResult(){
        const s = calcScores(qs, answers);
        const { radar, hyperAvg, hypoAvg, overall, dominant, maxAny, lvDominant, lvBalanced } = s;

        let titleObj = null, axisLabel = null, roleImg = null, level = null, lvLabel = 'Lv';
        if (overall === 'balanced') {
          titleObj = { t:'バランス型：ノーマライザー', role:'ノーマライザー' };
          axisLabel = 'バランス型';
          roleImg = IMAGES.balanced;
          level = lvBalanced;       // バランス度（0–99）
          lvLabel = 'Lv（バランス度）';
        } else {
          const axis = AXES.find(a=>a.key===dominant);
          axisLabel = axis ? axis.label : '';
          titleObj = TITLES[overall][dominant];
          roleImg = overall==='hyper' ? IMAGES.rolesHyper[dominant] : IMAGES.rolesHypo[dominant];
          level = lvDominant;       // 代表軸の強さ（0–99）
        }

        let headNote = '';
        if (overall === 'balanced' && maxAny <= 25) {
          headNote = '今回は大きな偏りは見つかりませんでした。状況や体調によって感じ方がゆるやかに変わる、柔軟タイプかもしれません。';
        } else if (overall === 'balanced') {
          headNote = `大きな偏りはありませんでした。比較的「${AXES.find(a=>a.key===dominant)?.label ?? '—'}」が気になりやすいかもしれません。`;
        } else {
          headNote = `いちばん強く特徴が出たのは「${axisLabel}」。全体としては<strong>${overall==='hyper'?'過敏':'鈍麻'}</strong>の傾向がやや高めでした。`;
        }

        app.innerHTML = `
          <div class="grid">
            <div class="card center">
              <h2>結果</h2>
              <div class="muted">${headNote}</div>
              ${roleImg ? `<img class="role" src="${roleImg}" alt="${titleObj.t}">` : ``}
              <div style="font-weight:700; margin-top:6px">称号：${titleObj.t}</div>
              <div class="level-display">${lvLabel}：<span>Lv${String(level).padStart(2,'0')}</span>　ジョブ：${titleObj.role}</div>
              <div style="height:360px; margin:14px auto 0; display:flex; align-items:center; justify-content:center; max-width:560px;">
                <canvas id="radar"></canvas>
              </div>
            </div>

            <div class="card">
              <h3>各特性のレベル</h3>
              <div class="level-grid">
                ${renderAxisLevelBadges(radar)}
              </div>
            </div>

            ${ overall==='balanced' && maxAny<=25 ? renderLowOverallCard() : renderAxisFeedback(radar) }

            <div class="card share">
              <div style="font-weight:700;">結果をシェア</div>
              <div class="buttons">
                <button id="shareXlink"  class="button x">X でシェア</button>
                <button id="shareFBlink" class="button fb">Facebook でシェア</button>
              </div>
              <div class="small muted" style="text-align:center">
                改行入りの短文（140字以内）＋短いリンクで投稿します。
              </div>
              <div style="margin-top:8px; text-align:center"><button id="retryBtn" class="button">もう一度調べる</button></div>
            </div>

            <div class="card cta">
              <div style="display:grid; gap:16px; grid-template-columns:1fr; align-items:start">
                <img class="seminar-banner" src="images/0823seminar.png" alt="オンラインセミナー 8/23 バナー">
                <div>
                  <h3 style="color:#1e3a8a;">保護者向け｜感覚過敏の子・不登校の子を支える具体策（${SEMINAR_DATE} オンライン）</h3>
                  <p>KANKAKUクエストの結果、あなた（/お子さん）は <strong>「称号：${titleObj.t}」</strong>（${lvLabel}：Lv${String(level).padStart(2,'0')}）。その特徴に合わせて、日常の「しんどい」を軽くするヒントを保護者目線でお伝えします。</p>
                  <ul>
                    <li>感覚過敏が学校生活に与える影響と見立て方（音・光・衣服・におい・食事・温度/痛み・動き）</li>
                    <li>家で今日からできる環境調整と声かけ（朝の準備、通学/在宅の工夫）</li>
                    <li>学校・支援先への伝え方（合理的配慮のお願い文例、先生への共有ポイント）</li>
                    <li>不登校期の過ごし方と、復帰／進路選択に向けたステップ</li>
                  </ul>
                  <p><strong>特別講師：加藤 路瑛（感覚過敏研究所 所長）</strong><br>
                     <strong>共催・進行：まなクロ にっしー（元教員／不登校支援者）</strong></p>
                  <div style="margin-top:10px">
                    <a class="button primary" target="_blank" href="${SEMINAR_URL}">申し込みページ（Googleフォーム）</a>
                  </div>
                </div>
              </div>
            </div>
          </div>`;

        // チャート
        const ctx = document.getElementById('radar');
        new Chart(ctx, {
          type: 'radar',
          data: {
            labels: radar.map(d=>d.axis),
            datasets: [
              { label:'過敏', data: radar.map(d=>d.hyper), fill:true, borderColor:'#111827', backgroundColor:'rgba(17,24,39,0.35)' },
              { label:'鈍麻', data: radar.map(d=>d.hypo),  fill:true, borderColor:'#60a5fa', backgroundColor:'rgba(96,165,250,0.25)' },
            ]
          },
          options: { scales:{ r:{ suggestedMin:0, suggestedMax:100 } }, plugins:{ legend:{position:'bottom'} } }
        });

        // シェア（改行入り140字）
        const shortText = buildShortShareText({
          title: titleObj.t, level, overall, dominant
        });
        document.getElementById('shareXlink').onclick = () => {
          const t = encodeURIComponent(shortText);
          window.open(`https://twitter.com/intent/tweet?text=${t}`,'_blank');
        };
        document.getElementById('shareFBlink').onclick = () => {
          const u = encodeURIComponent(baseURL());
          window.open(`https://www.facebook.com/sharer/sharer.php?u=${u}`,'_blank');
        };

        document.getElementById('retryBtn').onclick = () => { qs=[]; answers={}; index=0; renderStart(); };
        window.scrollTo({top:0, behavior:'smooth'});
      }

      /* ================ 各特性Lvバッジ ================ */
      function renderAxisLevelBadges(radar){
        return radar.map(d=>{
          const mode = d.hyper>d.hypo ? '過敏' : (d.hypo>d.hyper ? '鈍麻' : '同程度');
          const lv = pctToLv(Math.max(d.hyper, d.hypo)); // 0–99
          return `
            <div class="level-item">
              <div><strong>${d.axis}</strong><span class="chip">${mode}</span></div>
              <div class="lv">Lv${String(lv).padStart(2,'0')}</div>
            </div>
          `;
        }).join('');
      }

      /* ================ ロジック ================ */
function pickQuestions(count){
  // 軸ごとに過敏2・鈍麻2を集める
  const byAxis = Object.fromEntries(AXES.map(a=>[a.key,{hyper:[],hypo:[]}])); 
  BANK.forEach(q => byAxis[q.axis][q.trait].push(q));

  const picked = [];
  AXES.forEach(ax=>{
    const H = byAxis[ax.key].hyper.slice(0,2);
    const Y = byAxis[ax.key].hypo.slice(0,2);
    picked.push(...H, ...Y);
  });
  return shuffle(picked).slice(0, count); // 念のためcountで切る
}

// フィッシャー–イェーツ
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}


// p=0–100 を Lv=0–99 に変換（少し緩やか）
const pctToLv = p => Math.min(99, Math.max(0, Math.floor(Math.pow(p/100, 1.15) * 99)));


      // スコア計算（非線形ウェイト）
      function calcScores(questions, answers){
        const sums = Object.fromEntries(AXES.map(a=>[a.key,{h:0,y:0,hc:0,yc:0}]));
        questions.forEach(q=>{
          const v = answers[q.id];
          if(v==null) return;
          const w = LIKERT_WEIGHT[v] ?? 0; // 非線形
          if(q.trait==='hyper'){sums[q.axis].h += w; sums[q.axis].hc++;}
          else                 {sums[q.axis].y += w; sums[q.axis].yc++;}
        });

        const radar = AXES.map(ax=>{
          const maxH = Math.max(1, sums[ax.key].hc * 1.0);
          const maxY = Math.max(1, sums[ax.key].yc * 1.0);
          const hyper = Math.round((sums[ax.key].h / maxH) * 100);
          const hypo  = Math.round((sums[ax.key].y / maxY) * 100);
          return { axis: ax.label, axisKey: ax.key, hyper, hypo };
        });

        const hyperAvg = Math.round(radar.reduce((a,d)=>a+d.hyper,0)/radar.length);
        const hypoAvg  = Math.round(radar.reduce((a,d)=>a+d.hypo,0)/radar.length);
        const maxAny   = Math.max(...radar.map(d=>Math.max(d.hyper,d.hypo)));

        // バランス判定を少し広めに
        const EPS = 6;   // 平均差のしきい値（%）
        const LOW = 25;  // 低強度のしきい値
        let overall;
        if (maxAny <= LOW || Math.abs(hyperAvg - hypoAvg) <= EPS) {
          overall = 'balanced';
        } else {
          overall = (hyperAvg > hypoAvg) ? 'hyper' : 'hypo';
        }

        // 代表軸
        let dominantKey = radar[0].axisKey, best=-1;
        radar.forEach(d=>{ const m=Math.max(d.hyper,d.hypo); if(m>best){best=m; dominantKey=d.axisKey;} });

        // Lv計算
        const dom = radar.find(r=>r.axisKey===dominantKey);
        const lvDominant = pctToLv(Math.max(dom.hyper, dom.hypo));
        const lvBalanced = pctToLv(100 - maxAny);

        return { radar, hyperAvg, hypoAvg, overall, dominant: dominantKey, maxAny, lvDominant, lvBalanced };
      }

      function renderAxisFeedback(radar){
        const scored = radar.map(d=>({ key:d.axisKey, label:d.axis, hyper:d.hyper, hypo:d.hypo }));
        const picks = scored.filter(s=>Math.max(s.hyper,s.hypo)>=60)
                            .sort((a,b)=>Math.max(b.hyper,b.hypo)-Math.max(a.hyper,a.hypo));
        const list = (picks.length? picks: scored.sort((a,b)=>Math.max(b.hyper,b.hypo)-Math.max(a.hyper,a.hypo)).slice(0,3));
        return list.map(s=>{
          const mode = s.hyper> s.hypo ? 'hyper' : (s.hypo> s.hyper? 'hypo':'mix');
          const book = COMMENT_BOOK[s.key];
          const strong = mode==='mix'? [...book.hyper.strong,...book.hypo.strong].slice(0,2) : book[mode].strong;
          const challenge = mode==='mix'? [...book.hyper.challenge,...book.hypo.challenge].slice(0,2) : book[mode].challenge;
          const tips = mode==='mix'? [...book.hyper.tips,...book.hypo.tips].slice(0,3) : book[mode].tips;
          return `
            <div class="card">
              <h3>${s.label}</h3>
              <div class="small muted">過敏:${s.hyper}% / 鈍麻:${s.hypo}%</div>
              <div class="cols" style="margin-top:8px">
                <div><div style="font-weight:600; margin-bottom:6px">得意なこと（強み）</div><ul>${strong.map(x=>`<li>${x}</li>`).join('')}</ul></div>
                <div><div style="font-weight:600; margin-bottom:6px">苦手になりやすいこと</div><ul>${challenge.map(x=>`<li>${x}</li>`).join('')}</ul></div>
                <div><div style="font-weight:600; margin-bottom:6px">対処法のヒント</div><ul>${tips.map(x=>`<li>${x}</li>`).join('')}</ul></div>
              </div>
            </div>`;
        }).join('');
      }

      function renderLowOverallCard(){
        return `
          <div class="card">
            <h3>今回のまとめ</h3>
            <p class="muted">全体的に大きな偏りは見られませんでした。日によって「少し気になる」「今日は平気」など、ゆるやかな変化があるタイプかもしれません。</p>
            <ul>
              <li>困りごとが少ない時は、そのままの環境でOK</li>
              <li>疲れている日は、音や光など一つだけでもコントロールできると楽に</li>
              <li>「しんどさログ」をつけると自分の傾向が見つけやすい</li>
            </ul>
          </div>
        `;
      }

      /* ================ 初期化（ロゴでトップ） ================ */
      window.addEventListener('DOMContentLoaded', () => {
        const btnTop = document.getElementById('seminarBtnTop');
        if (btnTop) btnTop.href = SEMINAR_URL;
        document.getElementById('homeLink')?.addEventListener('click',(e)=>{ e.preventDefault(); qs=[]; answers={}; index=0; renderStart(); });
        renderStart();
      });
    </script>
  </body>
</html>
